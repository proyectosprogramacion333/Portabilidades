<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ahorra en tu Factura Móvil</title>
  <!-- Se incluye Chart.js para el gauge -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --azul-marino: #002855;
      --verde-movistar: #66CC00;
      --blanco: #FFFFFF;
      --gris-claro: #F8F9FA;
    }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--gris-claro);
    }
    /* Estilo para botones generales */
    .btn {
      display: inline-block;
      padding: 15px 30px;
      background: var(--verde-movistar);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      text-align: center;
      margin-top: 20px;
    }
    .btn:hover {
      background: #72b434;
      transform: scale(1.02);
    }
    /* Sólo la pantalla activa se muestra */
    .screen {
      display: none;
      max-width: 1100px;
      margin: 20px auto;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      min-height: 80vh;
      position: relative;
      background: var(--blanco);
    }
    .screen.active {
      display: block;
    }
    .screen:not(.active) {
      display: none !important;
    }
    /* Pantalla 1 - Inicio */
    #screen1 {
      background: var(--azul-marino);
      color: var(--blanco);
      text-align: center;
      background-image: url(https://lh3.googleusercontent.com/d/1te2dQ36-nCebkYja8doga3l4oxurjNWM=s0);
      background-size: contain;
      background-position: center 130%;
      background-repeat: no-repeat;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 80vh;
      padding: 60px;
    }
    /* Pantalla 2 - Datos (popup) */
    #screen2 {
      background: var(--blanco);
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      z-index: 1000;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }
    #screen2 form input {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #screen2 form button {
      display: block;
      width: 100%;
      padding: 15px;
      background: var(--verde-movistar);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    #screen2 p {
      text-align: center;
      margin-top: 15px;
      font-size: 12px;
    }
    /* Estructura de las preguntas */
    .question-screen header {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
      position: relative;
    }
    .question-screen header .logo {
      width: 60px;
      height: 60px;
      margin-right: 20px;
    }
    .question-screen header p {
      font-size: 14px;
      color: #555;
    }
    .question-screen .progress-bar {
      width: 100%;
      height: 8px;
      background: #eee;
      border-radius: 4px;
      margin: 20px 0;
    }
    .question-screen .progress {
      height: 100%;
      background: var(--verde-movistar);
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    .question-screen .question-content h3 {
      margin-bottom: 20px;
    }
    .question-screen .question-content button {
      display: block;
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      background: var(--verde-movistar);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: opacity 0.3s;
    }
    .question-screen .question-content button:hover {
      opacity: 0.9;
    }
    /* Flecha indicadora para la primera pregunta */
    .arrow-down {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: var(--azul-marino);
      animation: bounce 3.0s infinite;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
      40% { transform: translateX(-50%) translateY(-10px); }
      60% { transform: translateX(-50%) translateY(-5px); }
    }
    /* Pantalla de resultados */
    #results {
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
      padding: 20px;
    }
    /* Contenedor fijo para el gauge */
    #gaugeContainer {
      width: 200px;
      height: 100px;
      margin: 0 auto;
    }
    /* Estilo para el video promocional */
    #promoVideo {
      margin: 30px 0;
    }
    #results button {
      padding: 15px 20px;
      background: var(--verde-movistar);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Pantalla 1: Inicio -->
  <div class="screen active" id="screen1">
    <div class="screen-content">
      <h1>¡Ahorra en tu factura de celular hoy mismo!</h1>
      <p>Responde estas 6 preguntas y te enviaremos un reporte personalizado</p>
    </div>
    <button class="btn" onclick="showScreen('screen2')">Hacer el cuestionario</button>
  </div>

  <!-- Pantalla 2: Datos (popup) -->
  <div class="screen" id="screen2">
    <h2>Ingresa tus datos para empezar el test</h2>
    <form id="userData" onsubmit="event.preventDefault();startTest(); saveLead1();">
      <input type="text" placeholder="Nombre*" required>
      <input type="text" placeholder="Apellido Paterno*" required>
      <input type="email" placeholder="Correo electrónico*" required>
      <input type="tel" placeholder="Número telefónico*" required>
      <button type="submit">Comenzar test</button>
    </form>
    <p>Política de Privacidad</p>
  </div>

  <!-- Pantalla 3: Pregunta 1 -->
  <div class="screen question-screen" id="question1">
    <header>
      <!-- Logo integrado en formato SVG -->
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="none"/>
          <rect x="50" y="30" width="100" height="140" rx="15" ry="15" fill="#66CC00" />
          <rect x="65" y="45" width="70" height="110" rx="8" ry="8" fill="#FFFFFF" />
          <rect x="75" y="55" width="50" height="90" rx="5" ry="5" fill="#F0F0F0" />
          <polyline points="30,100 60,100 60,90" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="30,100 30,90 40,95" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="170,100 140,100 140,110" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="170,100 170,110 160,105" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
          <text x="100" y="190" font-family="Poppins, sans-serif" font-size="18" fill="#002855" text-anchor="middle">Cambio Móvil</text>
        </svg>
      </div>
      <p>Te ayudamos a ahorrar en tu línea móvil sin complicaciones</p>
     <!-- <div class="arrow-down">↓ Desplázate hacia abajo</div> -->
    </header>
    <div class="progress-bar">
      <div class="progress" style="width: 17%"></div>
    </div>
    <div class="question-content">
      <h3>¿Con qué compañía tienes actualmente tu línea móvil?</h3>
      <button onclick="addScore(1)">Telcel</button>
      <button onclick="addScore(5)">Movistar</button>
      <button onclick="addScore(3)">AT&T</button>
      <button onclick="addScore(4)">BAIT</button>
      <button onclick="addScore(0)">Otros</button>
    </div>
  </div>

  <!-- Pantalla 4: Pregunta 2 -->
  <div class="screen question-screen" id="question2">
    <header>
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="none" />
          <rect x="50" y="30" width="100" height="140" rx="15" ry="15" fill="#66CC00" />
          <rect x="65" y="45" width="70" height="110" rx="8" ry="8" fill="#FFFFFF" />
          <rect x="75" y="55" width="50" height="90" rx="5" ry="5" fill="#F0F0F0" />
          <polyline points="30,100 60,100 60,90" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="30,100 30,90 40,95" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 140,100 140,110" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 170,110 160,105" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <text x="100" y="190" font-family="Poppins, sans-serif" font-size="18" fill="#002855" text-anchor="middle">Cambio Móvil</text>
        </svg>
      </div>
      <p>Te ayudamos a ahorrar en tu línea móvil sin complicaciones</p>
    </header>
    <div class="progress-bar">
      <div class="progress" style="width: 34%"></div>
    </div>
    <div class="question-content">
      <h3>¿Cada cuánto recargas tu teléfono?</h3>
      <button onclick="addScore(1)">Cada 2 días</button>
      <button onclick="addScore(3)">Cada 5 días</button>
      <button onclick="addScore(7)">Cada 7 días</button>
      <button onclick="addScore(8)">Cada 15 días</button>
      <button onclick="addScore(10)">Cada 30 días</button>
      <button onclick="addScore(0)">Otro</button>
    </div>
  </div>

  <!-- Pantalla 5: Pregunta 3 -->
  <div class="screen question-screen" id="question3">
    <header>
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="none" />
          <rect x="50" y="30" width="100" height="140" rx="15" ry="15" fill="#66CC00" />
          <rect x="65" y="45" width="70" height="110" rx="8" ry="8" fill="#FFFFFF" />
          <rect x="75" y="55" width="50" height="90" rx="5" ry="5" fill="#F0F0F0" />
          <polyline points="30,100 60,100 60,90" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="30,100 30,90 40,95" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 140,100 140,110" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 170,110 160,105" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <text x="100" y="190" font-family="Poppins, sans-serif" font-size="18" fill="#002855" text-anchor="middle">Cambio Móvil</text>
        </svg>
      </div>
      <p>Te ayudamos a ahorrar en tu línea móvil sin complicaciones</p>
    </header>
    <div class="progress-bar">
      <div class="progress" style="width: 51%"></div>
    </div>
    <div class="question-content">
      <h3>¿Cuánto gastas al mes en recargas?</h3>
      <button onclick="addScore(1)">30</button>
      <button onclick="addScore(2)">50-60</button>
      <button onclick="addScore(5)">100</button>
      <button onclick="addScore(2)">200</button>
      <button onclick="addScore(1)">300</button>
      <button onclick="addScore(0)">+ 300</button>
    </div>
  </div>

  <!-- Pantalla 6: Pregunta 4 -->
  <div class="screen question-screen" id="question4">
    <header>
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="none" />
          <rect x="50" y="30" width="100" height="140" rx="15" ry="15" fill="#66CC00" />
          <rect x="65" y="45" width="70" height="110" rx="8" ry="8" fill="#FFFFFF" />
          <rect x="75" y="55" width="50" height="90" rx="5" ry="5" fill="#F0F0F0" />
          <polyline points="30,100 60,100 60,90" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="30,100 30,90 40,95" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 140,100 140,110" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 170,110 160,105" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <text x="100" y="190" font-family="Poppins, sans-serif" font-size="18" fill="#002855" text-anchor="middle">Cambio Móvil</text>
        </svg>
      </div>
      <p>Te ayudamos a ahorrar en tu línea móvil sin complicaciones</p>
    </header>
    <div class="progress-bar">
      <div class="progress" style="width: 68%"></div>
    </div>
    <div class="question-content">
      <h3>¿Has comparado tu oferta actual con el resto de las compañías en los últimos 6 meses?</h3>
      <button onclick="addScore(4)">Sí</button>
      <button onclick="addScore(2)">No</button>
    </div>
  </div>

  <!-- Pantalla 7: Pregunta 5 -->
  <div class="screen question-screen" id="question5">
    <header>
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="none" />
          <rect x="50" y="30" width="100" height="140" rx="15" ry="15" fill="#66CC00" />
          <rect x="65" y="45" width="70" height="110" rx="8" ry="8" fill="#FFFFFF" />
          <rect x="75" y="55" width="50" height="90" rx="5" ry="5" fill="#F0F0F0" />
          <polyline points="30,100 60,100 60,90" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="30,100 30,90 40,95" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 140,100 140,110" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 170,110 160,105" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <text x="100" y="190" font-family="Poppins, sans-serif" font-size="18" fill="#002855" text-anchor="middle">Cambio Móvil</text>
        </svg>
      </div>
      <p>Te ayudamos a ahorrar en tu línea móvil sin complicaciones</p>
    </header>
    <div class="progress-bar">
      <div class="progress" style="width: 85%"></div>
    </div>
    <div class="question-content">
      <h3>¿Experimentas caídas en tus llamadas o problemas de cobertura?</h3>
      <button onclick="addScore(0)">Sí</button>
      <button onclick="addScore(5)">No</button>
    </div>
  </div>

  <!-- Pantalla 8: Pregunta 6 -->
  <div class="screen question-screen" id="question6">
    <header>
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <rect width="200" height="200" fill="none" />
          <rect x="50" y="30" width="100" height="140" rx="15" ry="15" fill="#66CC00" />
          <rect x="65" y="45" width="70" height="110" rx="8" ry="8" fill="#FFFFFF" />
          <rect x="75" y="55" width="50" height="90" rx="5" ry="5" fill="#F0F0F0" />
          <polyline points="30,100 60,100 60,90" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="30,100 30,90 40,95" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 140,100 140,110" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <polyline points="170,100 170,110 160,105" fill="none" stroke="#002855" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
          <text x="100" y="190" font-family="Poppins, sans-serif" font-size="18" fill="#002855" text-anchor="middle">Cambio Móvil</text>
        </svg>
      </div>
      <p>Te ayudamos a ahorrar en tu línea móvil sin complicaciones</p>
    </header>
    <div class="progress-bar">
      <div class="progress" style="width: 100%"></div>
    </div>
    <div class="question-content">
      <h3>¿Te interesaría una consulta gratuita para explorar mejores tarifas adaptadas a tu uso?</h3>
      <button onclick="addScore(5)">Sí</button>
      <button onclick="addScore(1)">No</button>
    </div>
  </div>

  <!-- Pantalla 9: Resultados + Pantalla 10: Video promocional y llamada -->
  <div class="screen" id="results">
    <h2>¡Felicidades por completar el cuestionario Ahorra en tu gasto del celular!</h2>
    <p>Tu potencial de ahorro es muy alto. Tienes muchas oportunidades de pagar menos por lo que usas. ¡Revisa tu puntaje!</p>
    <!-- Contenedor fijo para el gauge -->
    <div id="gaugeContainer" style="width:200px; height:100px; margin:0 auto;">
      <canvas id="gaugeChart" width="200" height="100"></canvas>
    </div>
    <p>Tu puntuación: <span id="finalScore">0</span>/100</p>
    <!-- Pantalla 10: Video promocional -->    
    <div id="promoVideo">
      <iframe width="100%" height="315" src="https://www.youtube.com/embed/pS_es1-4keo?si=8tytas2irbI8uBKi" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    </div>
    <button onclick="saveLead_notificacion()">Agenda una llamada con un especialista</button>
  </div>

  <script>
    let currentQuestion = 1; // desde 1 hasta 6
    let totalScore = 0;
    const userData = { responses: [] };  // Se almacenarán las respuestas
    let gaugeChart; // variable global para el gráfico

    // Función para mostrar la pantalla con id dado y hacer scroll hacia ella
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const activeScreen = document.getElementById(screenId);
      activeScreen.classList.add('active');
      activeScreen.scrollIntoView({ behavior: 'smooth' });
    }

    // Inicia el test luego de ingresar los datos y guarda el lead en Google Sheets vía Apps Script
    function startTest() {
      const inputs = document.querySelectorAll('#screen2 input');
      userData.nombre = inputs[0].value;
      userData.apellido = inputs[1].value;
      userData.email = inputs[2].value;
      userData.telefono = inputs[3].value;
      // Inicializamos el array de respuestas
      userData.responses = [];
      currentQuestion = 1;
      showScreen(`question${currentQuestion}`);
    }

    // Se ejecuta cada vez que se responde una pregunta; suma el puntaje, guarda la respuesta y pasa a la siguiente pantalla
    function addScore(points) {
      totalScore += points;
      // Guarda la respuesta (puedes ampliar la lógica para guardar la opción seleccionada)
      userData.responses.push({ question: currentQuestion, score: points });
      if (currentQuestion < 6) {
        currentQuestion++;
        showScreen(`question${currentQuestion}`);
      } else {
        showResults();
      }
    }

    // Muestra la pantalla de resultados y actualiza el gauge con Chart.js
    function showResults() {
      document.getElementById('finalScore').textContent = totalScore;
      let value = totalScore; // Se asume un máximo de 100
      if (!gaugeChart) {
        const ctx = document.getElementById('gaugeChart').getContext('2d');
        gaugeChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            datasets: [{
              data: [value, 100 - value],
              backgroundColor: ['#66CC00', '#D3D3D3'],
              borderWidth: 0,
              cutout: '80%',
              rotation: 270,
              circumference: 180
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: { enabled: false }
            }
          }
        });
      } else {
        gaugeChart.data.datasets[0].data = [value, 100 - value];
        gaugeChart.update();
      }
      showScreen('results');
    }

 // Función para guardar el lead en Google Sheets vía Google Apps Script (sin leer respuesta)
async function saveLead1() {
  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbz2t69o5ORL9mPx4lU6T5Wj46dJGTpNWrk2YCnoe0hfLruNZ7_rz4tpPNTDvStHqqN4/exec", {
      method: "POST",
      mode: "no-cors",  // <--- Usamos no-cors
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(userData)
    });
    // La respuesta será opaca; no se puede leer, pero la solicitud se realizó
    console.log("Solicitud enviada (no-cors).");
  } catch (error) {
    console.error("Error al enviar la solicitud:", error);
  }
}

// Función para guardar el lead y enviar notificación (igual, modo no-cors)
async function saveLead_notificacion() {
  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycby0is6a8cAfizHASTYtMTZPxOb2GDigb0694tBcAiXtYoOjHlqSdg11NY_0jOofGM88/exec", {
      method: "POST",
      mode: "no-cors",  // <--- Usamos no-cors
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(userData)
    });
    console.log("Solicitud de notificación enviada (no-cors).");
    alert("¡Gracias! Nos pondremos en contacto contigo pronto.");
  } catch (error) {
    console.error("Error al enviar la solicitud de notificación:", error);
  }
}
  </script>
</body>
</html>
